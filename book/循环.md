% 循环

Rust支持三种循环结构：`loop`、`while`和`for`。

## loop

`loop`是Rust中最简单的无限循环写法：

```rust
loop {
    println!("Loop forever!");
}
```

## while

Rust同样支持C/C++中的`while`语法：

```rust
let mut x = 5; // mut x: i32
let mut done = false; // mut done: bool

while !done {
    x += x - 3;

    println!("{}", x);

    if x % 5 == 0 {
        done = true;
    }
}
```

当需要一个无限循环体时，你可能会写出如下代码：

```rust
while true {
```

然而在Rust中，`loop`更适用于写无限循环代码：

```rust
loop {
```

这是因为Rust的流程分析会对以上两种循环代码区分对待，因而生成的机器码也会有所不同。
一个基本原则是，为编译器提供的信息越多，编译器生成的代码就会越安全和快速，因此我
们在需要无限循环的时候应优先使用`loop`。

## for

Rust的`for`用于编写循环固定次数的代码，其写法与C/C++中的for循环不太一样：

```c
for (x = 0; x < 10; x++) {
    printf( "%d\n", x );
}
```

```rust
for x in 0..10 {
    println!("{}", x); // x: i32
}
```

下面的伪代码以更加抽象的形式说明了`for`的语法结构：

```rust
for var in expression {
    code
}
```

以上伪代码中的`expression`（即表达式）必须能够返回一个[迭代器]，该迭代器被用来
逐个访问一系列元素，每次循环开始前，变量`var`都被绑定至迭代器返回的新元素，当迭
代器无法再返回元素时循环结束。

[迭代器]: 迭代器.md
[`IntoIterator`]: https://doc.rust-lang.org/std/iter/trait.IntoIterator.html

在我们的示例代码中，表达式`0..10`返回一个迭代器，该迭代器可用于遍历数字0-9。

没有提供C风格的`for`循环是Rust有意的设计结果，C语言的大量编程实践已经证明了人工处
理所有的循环要素是非常容易出错的，即便经验非常丰富的C程序员也经常在此犯错。

### Enumerate

当需要跟踪`for`循环的次数时，可以使用`.enumerate()`函数：

#### On ranges:

```rust
for (index, value) in (5..10).enumerate() {
    println!("index = {} and value = {}", index, value);
}
```

Outputs:

```text
index = 0 and value = 5
index = 1 and value = 6
index = 2 and value = 7
index = 3 and value = 8
index = 4 and value = 9
```

注意不要忘记在表示数字迭代范围的表达式两边加上括号。

#### 关于迭代器:

```rust
let lines = "hello\nworld".lines();

for (linenumber, line) in lines.enumerate() {
    println!("{}: {}", linenumber, line);
}
```

Outputs:

```text
0: hello
1: world
```

## 循环控制

首先让我们观察之前的`while`循环代码：

```rust
let mut x = 5;
let mut done = false;

while !done {
    x += x - 3;

    println!("{}", x);

    if x % 5 == 0 {
        done = true;
    }
}
```

我们维护了一个可变的布尔型变量`done`，该变量用于控制循环体的结束。Rust实际上还
提供了另外两个可以控制循环的关键字`break`和`continue`。我们可以通过`break`将上面
的代码改写为更简洁的`loop`循环：

```rust
let mut x = 5;

loop {
    x += x - 3;

    println!("{}", x);

    if x % 5 == 0 { break; }
}
```

除了`break`和`continue`以外，使用`return`语句也可以使循环结束。

`continue`的作用于C/C++中一样，它会提早结束当前循环并进入下一次循环。下面的代码
会输出0-10之间的奇数：

```rust
for x in 0..10 {
    if x % 2 == 0 { continue; }

    println!("{}", x);
}
```

## 循环标签

当循环的嵌套层数较多时，你也许希望在内层循环中通过`break`和`continue`语句来控制
外层循环。针对这种情况，你可以给循环体加上`命名标签`，然后在`break`和`continue`
关键字的后面添加要控制的循环体的标签即可。下面的代码会输出0-10之间所有的奇数对：

```rust
'outer: for x in 0..10 {
    'inner: for y in 0..10 {
        if x % 2 == 0 { continue 'outer; } // continues the loop over x
        if y % 2 == 0 { continue 'inner; } // continues the loop over y
        println!("x: {}, y: {}", x, y);
    }
}
```
